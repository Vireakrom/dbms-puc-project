{% extends "teacher/base.html" %}
{% block title %}Dashboard{% endblock %}

{% block head_extra %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    /* Dashboard-Specific Styles */
    .header {
        background: linear-gradient(90deg, #4a6cf7, #7b5dfb);
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
    }

    .container {
        width: 90%;
        margin: 20px auto;
    }

    .cards {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .cards a {
        flex: 1;
        padding: 20px;
        border-radius: 14px;
        color: white;
        text-decoration: none;
        text-align: center;
        transition: 0.3s;
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.2);
    }

    .card1 {
        background: linear-gradient(45deg, #1e88e5, #42a5f5);
    }

    .card2 {
        background: linear-gradient(45deg, #00c853, #64dd17);
    }

    .card3 {
        background: linear-gradient(45deg, #ff7043, #ff5252);
    }

    .card5 {
        background: linear-gradient(45deg, #ab47bc, #ec407a);
    }

    .cards a:hover {
        transform: scale(1.07);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
    }

    /* Upcoming Tests & Announcements Row */
    .row-box {
        display: flex;
        gap: 25px;
        margin: 30px;
        flex-wrap: wrap;
    }

    .upcoming-box {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 280px;
    }

    .test-card {
        background: #f7f8ff;
        padding: 15px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: 0.3s;
    }

    .delete-btn {
        background: #f44336;
        border: none;
        color: white;
        padding: 6px 12px;
        border-radius: 8px;
        cursor: pointer;
    }

    /* Announcements Box */
    .announcement-box {
        background: linear-gradient(135deg, #ffecd2, #fcb69f);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        flex: 1;
        min-width: 280px;
    }

    .announcement-box ul {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    .announcement-box li {
        background: rgba(255, 255, 255, 0.7);
        padding: 10px 12px;
        border-radius: 10px;
        margin-bottom: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    /* Charts */
    .charts-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 25px;
        margin: 40px;
    }

    .chart-box,
    .pie-box {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        text-align: center;
    }
</style>
{% endblock %}


{% block content %}

<div class="header">Teacher Dashboard</div>

<div class="container">
    <div class="cards">
        <a href="students.html" class="card1">
            <img src="https://img.icons8.com/?size=100&id=25220&format=png&color=ffffff" width="45">
            <h4>Student</h4>
            <p>60 Students</p>
        </a>
        <a href="grades.html" class="card2">
            <img src="https://img.icons8.com/?size=100&id=4910&format=png&color=ffffff" width="45">
            <h4> Grades</h4>
            <p>9 Grades</p>
        </a>
        <a href="test_creation.html" class="card3">
            <img src="https://img.icons8.com/?size=100&id=56576&format=png&color=ffffff" width="45">
            <h4>Tests</h4>
            <p>12 Tests</p>
        </a>
        <a href="report.html" class="card5">
            <img src="https://img.icons8.com/ios-filled/50/ffffff/report-card.png" width="45">
            <h4>Report</h4>
        </a>
    </div>
</div>

<div class="row-box">
    <!-- Upcoming Tests -->
    <div class="upcoming-box">
        <h3>Upcoming Tests</h3>
        <label><strong>Select Subject:</strong></label>
        <select id="subject" class="form-control mb-2">
            <option value="" disabled selected>Select a subject</option>
            <option value="ICT">ICT</option>
            <option value="Math">Math</option>
            <option value="English">Enlish</option>
            <option value="History">History</option>
            <option value="Geography">Geography</option>
            <option value="Physics">Physics</option>
            <option value="Biology">Biology</option>
            <option value="Chimistry">Chimistry</option>
            <option value="Khmer">khmer</option>
        </select>
        <input type="date" id="date" class="form-control mb-2">
        <input type="time" id="time" class="form-control mb-2">
        <button class="btn btn-primary w-100 mb-3" onclick="addTest()">Add Test</button>
        <div id="testContainer">
            <p class="text-center text-muted">No upcoming tests yet.</p>
        </div>
    </div>
    <!-- Announcements -->
    <div class="announcement-box">
        <h5>üì¢ Announcements</h5>
        <ul>
            <li>üìå Math test results due Friday.</li>
            <li>üìå Parent-teacher meeting on Monday.</li>
            <li>üìå Submit monthly reports by 20th Nov.</li>
        </ul>
    </div>
</div>


<div class="charts-container">
    <div class="chart-box">
        <h3>Pass / Fail per Grade</h3>
        <canvas id="passFailChart"></canvas>
    </div>

    <div class="pie-box">
        <h3>Tests Distribution (Grade 7-9)</h3>
        <canvas id="gradePieChart"></canvas>
    </div>
</div>

<script>
    // Upcoming Tests Logic
    const testContainer = document.getElementById("testContainer");
    let tests = [];

    function addTest() {
        const subject = document.getElementById("subject").value;
        const date = document.getElementById("date").value;
        const time = document.getElementById("time").value;
        if (!subject || !date || !time) { alert("Fill all fields"); return; }

        tests.push({ subject, date, time });
        document.getElementById("subject").value = "";
        document.getElementById("date").value = "";
        document.getElementById("time").value = "";

        renderTests();
    }

    function renderTests() {
        testContainer.innerHTML = "";
        if (tests.length === 0) {
            testContainer.innerHTML = "<p class='text-center text-muted'>No upcoming tests yet.</p>";
            return;
        }
        tests.forEach((t, index) => {
            const div = document.createElement("div");
            div.className = "test-card";
            div.innerHTML = `
            <div class="test-info">
                <p><strong>${t.subject}</strong></p>
                <p>üìÖ ${t.date} ‚è∞ ${t.time}</p>
            </div>
            <button class="delete-btn" onclick="deleteTest(${index})">Delete</button>
        `;
            testContainer.appendChild(div);
        });
    }

    function deleteTest(i) {
        tests.splice(i, 1);
        renderTests();
    }

    // Charts Logic
    new Chart(document.getElementById("passFailChart"), {
        type: 'bar',
        data: {
            labels: ["Grade 7", "Grade 8", "Grade 9"],
            datasets: [
                { label: 'Pass', data: [8, 10, 9], backgroundColor: '#4caf50' },
                { label: 'Fail', data: [2, 1, 3], backgroundColor: '#f44336' }
            ]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    new Chart(document.getElementById("gradePieChart"), {
        type: 'pie',
        data: {
            labels: ["Grade 7", "Grade 8", "Grade 9"],
            datasets: [{ data: [12, 12, 12], backgroundColor: ["#4a6cf7", "#28d18e", "#f7b64a"] }]
        }
    });
</script>

{% endblock %}