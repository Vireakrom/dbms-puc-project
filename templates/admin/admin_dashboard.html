{% extends "admin/admin_base.html" %}

{% block title %}Admin Dashboard{% endblock %}
{% block header_title %}Admin Dashboard{% endblock %}

{% block content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- FEATHER ICONS -->
<script src="https://unpkg.com/feather-icons"></script>

<style>
body { background: #f4f6fb; }

/* ===========================
   TOP 5 CARDS
=========================== */
.dashboard-cards {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: nowrap;
}

.stat-card {
    background:white;
    padding: 30px;
    border-radius: 18px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: 0.2s;
    cursor: pointer;
    flex: 1;
    height: 130px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    min-width: 150px;
}
.stat-card:hover { transform: translateY(-6px); }

.stat-title {
    font-size: 15px;
    color: #777;
    font-weight: 600;
    margin-bottom: 12px;
}

.stat-body {
    display: flex;
    gap: 15px;
    margin-top: 0;
    justify-content: center;
    align-items: center;
}

.stat-icon-circle {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 26px;
    color: white;
}

.stat-number {
    font-size: 30px;
    font-weight: 700;
    color: #1e293b;
}

/* ===========================
   NOTIFICATIONS
=========================== */
.notification-card {
    background: #fff;
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0px 4px 12px rgba(0,0,0,0.06);
    margin-top: -14px;
    min-height: 420px;
}

.notif-time {
    width: 60px;
    font-weight: 700;
}
.notif-time.blue { color: #0d47a1; }
.notif-time.green { color: #0a5c34; }
.notif-time.cyan { color: #0277bd; }
.notif-time.orange { color: #e65100; }
.notif-time.red { color: #b71c1c; }

.notif-line {
    width: 3px;
    height: 32px;
    margin-right: 10px;
    border-radius: 3px;
}

/* ===========================
   RESULT OVERVIEW
=========================== */
.result-card {
    background: #fff;
    padding: 25px;
    border-radius: 18px;
    box-shadow: 0px 4px 12px rgba(0,0,0,0.06);
    margin-top: -18px !important;
    min-height: 450px;
}

.result-divider {
    width: 60px;
    height: 3px;
    background: #3b82f6;
    margin: 8px auto 18px auto;
    border-radius: 4px;
}

.filter-select {
    padding: 6px 16px;
    padding-right: 2.5rem;
    border: 1px solid #d1d5db;
    border-radius: 10px;
    background-color: #f9fafb;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 16px 12px;
    font-size: 14px;
    cursor: pointer;
    appearance: none;
}
.filter-select:hover { border-color: #3b82f6; }

.result-chart-box {
    background: #f8faff;
    padding: 25px;
    border-radius: 16px;
    margin-top: 12px;
}

.result-inner {
    display: flex;
    justify-content: space-evenly;
    align-items: center;
}

.donut-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
}

.result-info-panel {
    background:white;
    padding:20px 25px;
    border-radius:20px;
    margin-left:20px;
    box-shadow:0 2px 10px rgba(0,0,0,0.05);
    min-width: 350px;  
}

/* ===========================
   LIVE EXAM MONITORING (IMPROVED SCROLL)
=========================== */

.outer-exam-wrapper {
    background: white;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    margin-top: 25px;
}

.exam-top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.nav-btn {
    background: white;
    border: 1px solid #d1d5db;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-size: 18px;
    cursor: pointer;
    transition: .2s;
}
.nav-btn:hover { background: #f1f5f9; }

.inner-dark-wrap {
    background: #F8FAFF;
    padding: 25px;
    border-radius: 16px;
}

/* FIXED + IMPROVED HORIZONTAL SCROLL UX */
.exam-scroll-container {
    display: flex;
    gap: 22px;
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
    width: 100%;
    padding-bottom: 10px;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

.exam-scroll-container::-webkit-scrollbar {
    height: 10px;
}
.exam-scroll-container::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 10px;
}
.exam-scroll-container::-webkit-scrollbar-track {
    background: #e2e8f0;
}

/* CARD */
.exam-box {
    background: #ffffff;
    width: 265px;
    padding: 23px;
    border-radius: 18px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.06);
    flex-shrink: 0;
    white-space: normal;
    position: relative;
}

.exam-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #e7efff;
    display: flex;
    justify-content: center;
    align-items: center;
}

.progress-horizontal {
    width: 100%;
    height: 10px;
    background: #e5e7eb;
    border-radius: 12px;
    margin-top: 20px;
}

.progress-fill {
    height: 100%;
    background: #22c55e;
    border-radius: 12px;
}

.exam-bottom {
    margin-top: 10px;
    color: #475569;
    font-size: 14px;
}

.exam-subject-tag {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #fff7a6;
    padding: 4px 12px;
    font-weight: 700;
    font-size: 15px;
    border-radius: 8px;
    color: #5c4a00;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    z-index: 10;
}

#examScroll {
    width: 100%;
    max-width: 100%;
    overflow-x: auto !important;
    display: flex;
}

.exam-box {
    flex: 0 0 265px !important;
    max-width: 265px !important;
}

/* ===========================================
   ⭐ APPLY CONSISTENT TITLE STYLE (SAFE BLOCK)
=========================================== */
.section-title {
    font-size: 20px !important;
    font-weight: 700 !important;
    margin-bottom: 10px;
    margin-top: 5px;
}
</style>

<!-- ================= TOP 5 CARDS ================= -->
<div class="dashboard-cards">

    <div class="stat-card" onclick="location.href='/students_list/'">
        <div class="d-flex justify-content-between align-items-center w-100 mb-3">
            <span class="stat-title">Total Students</span>
            <i class="bi bi-three-dots-vertical text-muted"></i>
        </div>

        <div class="stat-body justify-content-center">
            <div class="stat-number">{{ total_students }}</div>
            <div class="stat-icon-circle ms-3" style="background:#1565C0;">
                <i class="bi bi-people-fill"></i>
            </div>
        </div>
    </div>

    <div class="stat-card" onclick="location.href='/teachers-list/'">
        <div class="d-flex justify-content-between align-items-center w-100 mb-3">
            <span class="stat-title">Total Teachers</span>
            <i class="bi bi-three-dots-vertical text-muted"></i>
        </div>

        <div class="stat-body justify-content-center">
            <div class="stat-number">{{ total_teachers }}</div>
            <div class="stat-icon-circle ms-3" style="background:#009688;">
                <i class="bi bi-person-workspace"></i>
            </div>
        </div>
    </div>

    <div class="stat-card" onclick="location.href='/classes-list/'">
        <div class="d-flex justify-content-between align-items-center w-100 mb-3">
            <span class="stat-title">Total Classes</span>
            <i class="bi bi-three-dots-vertical text-muted"></i>
        </div>

        <div class="stat-body justify-content-center">
            <div class="stat-number">{{ total_classes }}</div>
            <div class="stat-icon-circle ms-3" style="background:#f39c12;">
                <i class="bi bi-door-open-fill"></i>
            </div>
        </div>
    </div>

    <div class="stat-card" onclick="location.href='/subjects-list/'">
        <div class="d-flex justify-content-between align-items-center w-100 mb-3">
            <span class="stat-title">Total Subjects</span>
            <i class="bi bi-three-dots-vertical text-muted"></i>
        </div>

        <div class="stat-body justify-content-center">
            <div class="stat-number">{{ total_subjects }}</div>
            <div class="stat-icon-circle ms-3" style="background:#8e44ad;">
                <i class="bi bi-journal-bookmark-fill"></i>
            </div>
        </div>
    </div>

    <div class="stat-card" onclick="location.href='/reports-list/'">
        <div class="d-flex justify-content-between align-items-center w-100 mb-3">
            <span class="stat-title">Total Reports</span>
            <i class="bi bi-three-dots-vertical text-muted"></i>
        </div>

        <div class="stat-body justify-content-center">
            <div class="stat-number">{{ total_reports }}</div>
            <div class="stat-icon-circle ms-3" style="background:#e74c3c;">
                <i class="bi bi-flag-fill"></i>
            </div>
        </div>
    </div>

</div>

<!-- ================= NOTIFICATION + RESULT OVERVIEW ================= -->
<div class="row g-4 align-items-stretch mt-3">

    <!-- LEFT: NOTIFICATIONS -->
    <div class="col-md-4 d-flex">
        <div class="notification-card flex-fill">
            <h3 class="section-title">Recent Notifications</h3>

            <ul class="list-unstyled mt-3">

                <li class="mb-3 d-flex">
                    <div class="notif-time blue">10:10</div>
                    <div class="notif-line" style="background:#1e88e5;"></div>
                    <div>Added Students Successfully.<br><small>by Johne</small></div>
                </li>

                <li class="mb-3 d-flex">
                    <div class="notif-time green">08:40</div>
                    <div class="notif-line" style="background:#2ecc71;"></div>
                    <div>Added Subjects Successfully.<br><small>by Amla</small></div>
                </li>

                <li class="mb-3 d-flex">
                    <div class="notif-time cyan">07:10</div>
                    <div class="notif-line" style="background:#00bcd4;"></div>
                    <div>Added Reports Successfully.<br><small>by Josef</small></div>
                </li>

                <li class="mb-3 d-flex">
                    <div class="notif-time orange">01:15</div>
                    <div class="notif-line" style="background:#ff7043;"></div>
                    <div>Grade 7A took Quiz 1.<br><small>by Rima</small></div>
                </li>

                <li class="mb-3 d-flex">
                    <div class="notif-time red">23:12</div>
                    <div class="notif-line" style="background:#e57373;"></div>
                    <div>Teacher created Successfully.<br><small>by Alaxa</small></div>
                </li>

            </ul>
        </div>
    </div>

    <!-- RIGHT: RESULT OVERVIEW -->
    <div class="col-md-8 d-flex">
        <div class="result-card flex-fill">

            <h3 class="section-title text-center">Result Overview</h3>
            <div class="result-divider"></div>

            <!-- FILTERS -->
            <div class="result-filters d-flex flex-wrap justify-content-center gap-3 mb-3">

                <select class="filter-select">
                    <option>Filter by Grade</option>
                    <option>All Grades</option>
                    <option>Grade 7</option>
                    <option>Grade 8</option>
                    <option>Grade 9</option>
                </select>

                <select class="filter-select">
                    <option>Filter by Teacher</option>
                    <option>Teacher A</option>
                    <option>Teacher B</option>
                    <option>Teacher C</option>
                </select>

                <select class="filter-select">
                    <option>Year</option>
                    <option>2023</option>
                    <option>2024</option>
                    <option>2025</option>
                </select>

                <select class="filter-select">
                    <option>Result Type</option>
                    <option>Top Result</option>
                    <option>Average</option>
                    <option>Fail</option>
                </select>

            </div>

            <!-- Chart Box -->
            <div class="result-chart-box">

                <div class="result-inner" style="align-items: flex-start;">

                    <!-- LEFT CHART -->
                    <div class="donut-wrapper" style="flex: 0 0 260px; text-align:center;">
                        <canvas id="resultChart" width="220" height="220"></canvas>
                    </div>

                    <!-- RIGHT PANEL -->
                    <div class="result-info-panel">

                        <h6 class="fw-bold mb-3">Performance Summary</h6>

                        <div class="mb-2"><b>Top Result:</b> 60 Students</div>
                        <div class="mb-2"><b>Average:</b> 30 Students</div>
                        <div class="mb-2"><b>Fail:</b> 10 Students</div>

                        <hr>

                        <p class="text-muted mb-1">Filtered Grade: <b>Grade 7</b></p>
                        <p class="text-muted mb-1">Teacher: <b>Teacher A</b></p>
                        <p class="text-muted mb-1">Year: <b>2024</b></p>

                    </div>

                </div>
            </div>

        </div>
    </div>

</div>

<!-- ================= LIVE EXAM MONITORING ================= -->
<div class="outer-exam-wrapper">

    <div class="exam-top-bar">
        <h3 class="section-title">Live Exams Monitoring</h3>
        <div>
            <button class="nav-btn" id="leftBtn"><i class="bi bi-chevron-left"></i></button>
            <button class="nav-btn" id="rightBtn"><i class="bi bi-chevron-right"></i></button>
        </div>
    </div>

    <div class="inner-dark-wrap">

        <div class="exam-scroll-container" id="examScroll">

            {% for exam in range(5) %}
            <div class="exam-box">
                <span class="exam-subject-tag">Subject {{ exam }}</span>
                <div class="exam-icon mb-2">
                    <i class="bi bi-pencil-square" style="font-size:22px;color:#2563eb;"></i>
                </div>
                <h5 class="fw-bold">Class {{ exam }} Test</h5>
                <p class="text-success">● Live Now</p>
                <div><i class="bi bi-clock"></i> 9.00 AM - 1.00 PM</div>
                <div><i class="bi bi-people"></i> {{ 40 + exam }} Students</div>
                <div class="progress-horizontal">
                    <div class="progress-fill" style="width: '{{ 40 + exam }}%';"></div>

                </div>
                <div class="exam-bottom">{{ 60 - exam }} min left</div>
            </div>
            {% endfor %}

        </div>
    </div>

</div>
<script>
document.addEventListener("DOMContentLoaded", () => {

    const scroller = document.getElementById("examScroll");
    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");

    const SCROLL_STEP = 320; // scroll one full card

    function updateButtons() {
        const maxScroll = scroller.scrollWidth - scroller.clientWidth;

        leftBtn.disabled = scroller.scrollLeft <= 0;
        rightBtn.disabled = scroller.scrollLeft >= maxScroll - 2;
    }

    function scrollLeft() {
        scroller.scrollBy({ left: -SCROLL_STEP, behavior: "smooth" });
        setTimeout(updateButtons, 350);
    }

    function scrollRight() {
        scroller.scrollBy({ left: SCROLL_STEP, behavior: "smooth" });
        setTimeout(updateButtons, 350);
    }

    leftBtn.addEventListener("click", scrollLeft);
    rightBtn.addEventListener("click", scrollRight);

    scroller.addEventListener("scroll", updateButtons);

    updateButtons();
});

/* Feather Icons */
feather.replace();

/* Result Chart */
new Chart(document.getElementById('resultChart'), {
    type:'doughnut',
    data:{
        labels:['Top Result','Average','Fail'],
        datasets:[{
            data:[60,30,10],
            backgroundColor:['#3b82f6','#f59e0b','#ef4444'],
            hoverOffset: 8
        }]
    },
    options:{
        responsive: false,
        maintainAspectRatio: false,
        cutout: '60%',
        plugins:{ legend:{ display:false } }
    }
});

/* Attendance Chart */
new Chart(document.getElementById('attendanceChart'), {
    data:{
        labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
        datasets:[
            { type:'bar', label:'Attendance',
              data:[430,500,410,660,220,410,180,350,720,300,260,150],
              backgroundColor:'rgba(111,66,193,0.45)', borderRadius:8, barThickness:30 },

            { type:'line', label:'Passed',
              data:[310,630,420,510,450,610,170,510,800,220,390,140],
              borderColor:'#0f8558', borderWidth:3, tension:0.4 }
        ]
    },
    options:{
        plugins:{ legend:{ display:false }},
        scales:{
            y:{ beginAtZero:true },
            x:{ grid:{ display:false }}
        }
    }
});
</script>
{% endblock %}